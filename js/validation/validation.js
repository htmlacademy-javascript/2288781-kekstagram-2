import { textDescription, textHashtags, MAX_HASHTAGS, MAX_HASHTAG_LENGTH, MAX_DESCRIPTION_LENGTH } from '../validation/form-data.js';

/*

- Четвертая задача:
Напишите код для валидации формы добавления изображения, используя библиотеку Pristine (скрипт находится в директории /vendor/pristine).
Список полей для валидации:
Хэштеги - 2.3.
Комментарий - 2.4.

Реализуйте логику проверки так, чтобы, как минимум, она срабатывала при попытке отправить форму и не давала этого сделать,
если форма заполнена не по правилам. При желании, реализуйте проверки сразу при вводе значения в поле.

2.3. хэштеги:

хэштег начинается с символа # (решётка);
строка после решётки должна состоять из букв и чисел и не может содержать пробелы, спецсимволы (#, @, $ и т. п.), символы пунктуации (тире, дефис, запятая и т. п.), эмодзи и т. д.;
хеш-тег не может состоять только из одной решётки;
максимальная длина одного хэштега 20 символов, включая решётку;
хэштеги нечувствительны к регистру: #ХэшТег и #хэштег считаются одним и тем же тегом;
хэштеги разделяются пробелами;
один и тот же хэштег не может быть использован дважды;
нельзя указать больше пяти хэштегов;
хэштеги необязательны;
если фокус находится в поле ввода хэштега, нажатие на Esc не должно приводить к закрытию формы редактирования изображения.

2.4. Комментарий:

комментарий не обязателен;
длина комментария не может составлять больше 140 символов;
если фокус находится в поле ввода комментария, нажатие на Esc не должно приводить к закрытию формы редактирования изображения.

- Пятая задача:
Реализуйте логику проверки так, чтобы, как минимум, она срабатывала при попытке отправить форму и не давала этого сделать, если форма заполнена не по правилам. При желании, реализуйте проверки сразу при вводе значения в поле.
3.2. Страница реагирует на неправильно введённые значения в форму. Если данные, введённые в форму, не соответствуют ограничениям, указанным в пунктах 2.3 и 2.4, форму невозможно отправить на сервер.

При попытке отправить форму с неправильными данными отправки не происходит, а пользователю показываются ошибки для неверно заполненных полей (для проверки данных используется сторонняя библиотека Pristine).

Ошибки выводятся внутри блока .img-upload__field-wrapper соответствующего поля. Также, если поле заполнено неверно, блоку, в котором выводится текст ошибки, добавляется класс .img-upload__field-wrapper--error.

Пример:

<div class="pristine-error img-upload__field-wrapper--error" style="">Неправильный хэштег</div>
Для разных ошибок показываются разные сообщения. Следует разделять случаи, когда:

введён невалидный хэштег;
превышено количество хэштегов;
хэштеги повторяются;
длина комментария больше 140 символов.
Количество одновременно показываемых сообщений для одного поля разработчик определяет самостоятельно.



?Валидация хеш-тегов?
Для валидации хэштегов вам придётся вспомнить, как работать с массивами.
Набор хэштегов можно превратить в массив, воспользовавшись методом .split().
Он разбивает строки на массивы.
После этого, вы можете написать цикл, который будет ходить по полученному массиву
и проверять каждый из хэштегов на предмет соответствия ограничениям.
Если хотя бы один из тегов не проходит нужных проверок, показывать сообщение об ошибке.

Поля, не перечисленные в техзадании, но существующие в разметке, особой валидации не требуют.
*/

export const isValidation = () => {
  const hashtagsValue = textHashtags.value;
  const descriptionValue = textDescription.value;

  const hashtagsArray = hashtagsValue.trim().split(' ').filter((tag) => tag !== '');


  if (hashtagsArray.length > MAX_HASHTAGS) {
    alert(`Нельзя указать больше ${MAX_HASHTAGS} хэш-тегов`);
    return false;
  }

  const lowerCaseTags = hashtagsArray.map((tag) => tag.toLowerCase());
  const uniqueTags = new Set(lowerCaseTags);
  if (uniqueTags.size < lowerCaseTags.length) {
    alert('Один и тот же хэш-тег не может быть использован дважды');
    return false;
  }

  for (let tag of hashtagsArray) {
    if (tag.length > MAX_HASHTAG_LENGTH) {
      alert(`Максимальная длина одного хэш-тега ${MAX_HASHTAG_LENGTH} символов`);
      return false;
    }
    if (!/^#[A-Za-zА-Яа-яЁё0-9]{1,19}$/.test(tag)) {
      alert('Хэш-тег должен начинаться с символа # и содержать только буквы и цифры');
      return false;
    }
  }

  if (descriptionValue.length > MAX_DESCRIPTION_LENGTH) {
    alert(`Максимальная длина описания фотографии ${MAX_DESCRIPTION_LENGTH} символов`);
    return false;
  }

  return true;
};
